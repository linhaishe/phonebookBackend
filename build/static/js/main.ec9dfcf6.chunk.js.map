{"version":3,"sources":["services/persons.js","components/Persons.js","components/PersonsForm.js","components/Filter.js","components/SuccessNotification.js","components/ErrorNotification.js","index.js"],"names":["baseUrl","axios","get","newObject","post","id","put","deleteId","delete","Persons","persons","handleDelete","console","log","name","number","onClick","PersonsForm","addName","newName","handleNameChange","newNumber","handleNumberChange","onSubmit","value","onChange","type","Filter","filterResult","SuccessNotification","message","className","ErrorNotification","App","useState","setPersons","setNewName","setNewNumber","newFilterword","setNewFilterword","successMessage","setSuccessMessage","errorMessage","setErrorMessage","useEffect","personService","then","response","data","filter","item","values","Object","str","map","String","toLowerCase","find","includes","toString","window","confirm","n","catch","setTimeout","event","target","i","personsCopy","preventDefault","nameObject","replace","length","alert","JSON","stringify","indexOf","concat","duplicateCheck","person","returnedPerson","updatePerson","trim","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.ec9dfcf6.chunk.js","sourcesContent":["import axios from \"axios\";\nconst baseUrl = \"/api/persons\";\n\nconst getAll = () => {\n  return axios.get(baseUrl);\n};\n\nconst create = (newObject) => {\n  return axios.post(baseUrl, newObject);\n};\n\nconst update = (id, newObject) => {\n  return axios.put(`${baseUrl}/${id}`, newObject);\n};\n\nconst deleteperson = (deleteId) => {\n  return axios.delete(`${baseUrl}/${deleteId}`);\n};\n\nexport default { getAll, create, update, deleteperson };\n","import React from \"react\";\n\n//显示人名组件\nconst Persons = ({ persons, handleDelete }) => {\n  console.log({ persons });\n  return (\n    <>\n      <li>\n        {persons.name} {persons.number}\n        <button onClick={handleDelete}> delete</button>\n      </li>\n    </>\n  );\n};\n\nexport default Persons;\n","import React from \"react\";\n\nconst PersonsForm = ({\n  addName,\n  newName,\n  handleNameChange,\n  newNumber,\n  handleNumberChange,\n}) => {\n  return (\n    <form onSubmit={addName}>\n      <div>\n        name: <input value={newName} onChange={handleNameChange} />\n      </div>\n      <div>\n        number: <input value={newNumber} onChange={handleNumberChange} />\n      </div>\n\n      <div>\n        <button type=\"submit\">add</button>\n      </div>\n    </form>\n  );\n};\n\nexport default PersonsForm;\n","import React from \"react\";\n\nconst Filter2 = ({ newFilterword, setNewFilterword, persons }) => {\n  const filterByValue = function filterByValue(arr, word) {\n    return arr.filter((o) =>\n      Object.keys(o).some((k) =>\n        o[k].toLowerCase().includes(word.toLowerCase())\n      )\n    );\n  };\n  const result = filterByValue(persons, newFilterword);\n  const handleFilterwordChange = (event) => {\n    setNewFilterword(event.target.value);\n  };\n\n  return (\n    <div>\n      filter shown with a{\" \"}\n      <input value={newFilterword} onChange={handleFilterwordChange} />\n    </div>\n  );\n};\n\n//不在组件中写任何函数和算法，并在APP根组件下进行遍历显示\nconst Filter = ({ filterResult }) => {\n  return (\n    <li>\n      {filterResult.name} {filterResult.number}\n    </li>\n  );\n};\n\nexport default Filter;\n","import React from \"react\";\n\nconst SuccessNotification = ({ message }) => {\n  if (message === null) {\n    return null;\n  }\n\n  return <div className=\"success\">{message}</div>;\n};\n\nexport default SuccessNotification;\n","import React from \"react\";\n\nconst ErrorNotification = ({ message }) => {\n  if (message === null) {\n    return null;\n  }\n\n  return <div className=\"error\">{message}</div>;\n};\n\nexport default ErrorNotification;\n","import React, { useState, useEffect } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport personService from \"./services/persons\";\nimport Persons from \"./components/Persons\";\nimport PersonsForm from \"./components/PersonsForm\";\nimport Filter from \"./components/Filter\";\nimport SuccessNotification from \"./components/SuccessNotification\";\nimport ErrorNotification from \"./components/ErrorNotification\";\n\n// axios.get(\"http://localhost:3001/persons\").then((response) => {\n//   const persons = response.data;\n// });\n\nconst App = () => {\n  //这个状态用props传进来的初始人名数组作为状态初始化，保存到notes中。\n  const [persons, setPersons] = useState([]);\n  const [newName, setNewName] = useState(\"\");\n  const [newNumber, setNewNumber] = useState(\"\");\n  const [newFilterword, setNewFilterword] = useState(\"\");\n  const [successMessage, setSuccessMessage] = useState(null);\n  const [errorMessage, setErrorMessage] = useState(null);\n\n  useEffect(() => {\n    // axios.get(\"http://localhost:3001/persons\")\n    personService.getAll().then((response) => {\n      setPersons(response.data);\n    });\n  }, []);\n\n  const addName = (event) => {\n    const personsCopy = { ...persons };\n    event.preventDefault();\n\n    //设定一个对象格式，确定数据的保存格式为一个对象\n    const nameObject = {\n      name: newName,\n      number: newNumber,\n    };\n\n    //如果为空值则提醒\n    if (\n      String(nameObject.name).replace(/(^\\s*)|(\\s*$)/g, \"\").length === 0 ||\n      String(nameObject.number).replace(/(^\\s*)|(\\s*$)/g, \"\").length === 0\n    ) {\n      alert(\"empty string,plz reconfirm\");\n      //未存在则添加\n    } else if (\n      JSON.stringify(personsCopy).indexOf(JSON.stringify(newName)) === -1\n    ) {\n      //添加新便笺到便笺列表中，concat方式数组添加\n      // setPersons(persons.concat(nameObject));\n      //重置受控input元素的值\n      // setNewName(\"\");\n      // setNewNumber(\"\");\n\n      personService\n        .create(nameObject)\n        // .post(\"http://localhost:3001/persons\", nameObject)\n        .then((response) => {\n          setSuccessMessage(`Note '${newName}' was add successfully`);\n          setTimeout(() => {\n            setSuccessMessage(null);\n          }, 5000);\n          setPersons(persons.concat(response.data));\n          setNewName(\"\");\n          setNewNumber(\"\");\n        });\n    } else {\n      //存在则提醒,并询问是否替换内容\n      const duplicateCheck = persons.find((person) => person.name === newName);\n      //名字相同，电话不同,则询问是否替换\n      if (\n        typeof duplicateCheck !== \"undefined\" &&\n        duplicateCheck.number !== newNumber\n      ) {\n        personService\n          .update(duplicateCheck.id, {\n            name: duplicateCheck.name,\n            number: newNumber,\n          })\n          .then((returnedPerson) => {\n            if (\n              window.confirm(\n                `${returnedPerson.name} is already added to phonebook,replace the old number with a new one?`\n              )\n            ) {\n              const updatePerson = persons.map((person) =>\n                person.id !== duplicateCheck.id ? person : returnedPerson.data\n              );\n              setPersons(updatePerson);\n              setNewName(\"\");\n              setNewNumber(\"\");\n            }\n          })\n          .catch(() => {\n            setErrorMessage(\n              `Information of '${newName}' has already been removed from the server`\n            );\n            setTimeout(() => {\n              setErrorMessage(null);\n            }, 5000);\n          });\n        return;\n      } else if (typeof duplicateCheck !== \"undefined\") {\n        //名字电话相同则提醒已存在\n        alert(`${newName} is already added to phonebook`);\n        setNewName(\"\");\n        setNewNumber(\"\");\n        return;\n      }\n    }\n\n    //question: 不去除前后无效空字符串，否则也会被添加，使用trim处理\n    //question: 需刷新后替换的新数据才会显示，如何优化？已处理，因为没有拿到值，导致显示为空\n  };\n\n  function filterByValue(values, str) {\n    return values\n      .map(function (value) {\n        return String(value).toLowerCase();\n      })\n      .find(function (value) {\n        return value.includes(str.toString().toLowerCase());\n      });\n  }\n\n  const filterResult = persons.filter(function (item) {\n    return filterByValue(Object.values(item), newFilterword);\n  });\n\n  const handleDelete = (id) => {\n    if (\n      window.confirm(`Do you really want to delete ${persons[id - 1].name}?`)\n    ) {\n      personService\n        .deleteperson(id)\n        .then((response) => {\n          //为什么这里console出来空对象？因为server没有返回任何数据，所以response.data是空对象，但response是有值的\n          // console.log(\"deletedeletedelete\", response.data);\n          setPersons(persons.filter((n) => n.id !== id));\n        })\n        .catch(() => {\n          setErrorMessage(\n            `Information of '${\n              persons[id - 1].name\n            }' has already been removed from the server`\n          );\n          setTimeout(() => {\n            setErrorMessage(null);\n          }, 5000);\n        });\n    }\n  };\n\n  const handleNameChange = (event) => {\n    setNewName(event.target.value.trim());\n  };\n\n  const handleNumberChange = (event) => {\n    setNewNumber(event.target.value.trim());\n  };\n\n  const handleFilterwordChange = (event) => {\n    setNewFilterword(event.target.value);\n  };\n\n  // //根据输入的自字符进行筛选\n  // const filterByValue = function filterByValue(arr, word) {\n  //   return arr.filter((o) =>\n  //     Object.keys(o).some((k) =>\n  //       o[k].toLowerCase().includes(word.toLowerCase())\n  //     )\n  //   );\n  // };\n  // //TypeError: o[k].toLowerCase is not a function\n\n  // //input数据转化为字符串便于筛选function 运行\n  // const inputValue = newFilterword.toString();\n  // console.log(\"typeof inputValue\", typeof inputValue);\n\n  // // 得到筛选结果\n  // const result = filterByValue(persons, inputValue);\n\n  return (\n    <div>\n      <ErrorNotification message={errorMessage} />\n      <SuccessNotification message={successMessage} />\n      <h2>Phonebook</h2>\n      filter shown with{\" \"}\n      <input value={newFilterword} onChange={handleFilterwordChange} />\n      <p>\n        {filterResult.map((filterResult, i) => (\n          <Filter key={i} filterResult={filterResult} />\n        ))}\n      </p>\n      <h1>add a new</h1>\n      <PersonsForm\n        addName={addName}\n        newName={newName}\n        handleNameChange={handleNameChange}\n        newNumber={newNumber}\n        handleNumberChange={handleNumberChange}\n      />\n      <h2>Numbers</h2>\n      <p>\n        {/* 数的顺序会影响显示，person,name不等于name,person */}\n        {persons.map((persons, i) => (\n          <Persons\n            key={i}\n            persons={persons}\n            handleDelete={() => handleDelete(persons.id)}\n          />\n        ))}\n      </p>\n    </div>\n  );\n};\n\nexport default App;\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}